# AI Employee - Autonomous Digital FTE

> **Tier Declaration: Platinum** | Personal AI Employee Hackathon 2026

An autonomous AI-powered Full-Time Employee (FTE) that manages your business operations using **Claude Code** as its primary reasoning engine. It handles email triage, social media management across 4 platforms, Odoo accounting, task processing, and executive reporting — all with human-in-the-loop safety controls through an Obsidian vault-based state machine. **Platinum tier** adds cloud/local split deployment on Azure VM, Git-based vault sync, WhatsApp Business API for mobile approvals, and 24/7 operation with health monitoring.

---

## Live Deployment

| Resource | URL |
|----------|-----|
| **GitHub Repo** | [github.com/aimanhanif321/hacthon-0](https://github.com/aimanhanif321/hacthon-0) |
| **Azure VM (Cloud Zone)** | `20.64.238.101` — 24/7 Ubuntu 22.04 (Standard_B2s_v2, westus2) |
| **Health Endpoint** | [http://20.64.238.101:8080/health](http://20.64.238.101:8080/health) |
| **WhatsApp Webhook** | HTTPS via ngrok → Flask :5001 on VM |
| **Odoo Accounting** | [http://ai-employee-odoo.eastus.azurecontainer.io:8069](http://ai-employee-odoo.eastus.azurecontainer.io:8069) |
| **Database** | Neon DB (serverless PostgreSQL, eastus2) |

---

## Table of Contents

- [Architecture Overview](#architecture-overview)
- [Tier Breakdown](#tier-breakdown)
  - [Bronze Tier: Foundation](#bronze-tier-foundation)
  - [Silver Tier: Functional Assistant](#silver-tier-functional-assistant)
  - [Gold Tier: Autonomous Employee](#gold-tier-autonomous-employee)
  - [Platinum Tier: Cloud/Local Split Deployment](#platinum-tier-cloudlocal-split-deployment)
- [Quick Start](#quick-start)
- [All Commands Reference](#all-commands-reference)
- [Project Structure](#project-structure)
- [Setup Guides](#setup-guides)
- [Security Disclosure](#security-disclosure)
- [Demo Highlights](#demo-highlights)

---

## Architecture Overview

```
┌──── CLOUD ZONE (Azure VM — 24/7) ──────────────────────────────┐
│  scheduler.py ──▶ orchestrator.py ──▶ Claude CLI                │
│  Gmail poll, social drafts, briefings, audit, dashboard         │
│  Health endpoint: GET /health → :8080                           │
│  Watchers: filesystem_watcher.py, gmail_watcher.py              │
│                                                                  │
│  AI_Employee_Vault/ (Obsidian — Git synced)                      │
│  ├── Inbox/ → Needs_Action/ → In_Progress/ → Done/              │
│  ├── Pending_Approval/ (cloud creates, local executes)           │
│  └── Briefings/, Plans/, Dashboard.md                            │
└──────────────────────────┬───────────────────────────────────────┘
                           │ Git push/pull (every 60s)
                           │ AI_Employee_Vault/ ↔ GitHub
┌──────────────────────────┴───────────────────────────────────────┐
│  LOCAL ZONE (your laptop)                                         │
│  scheduler.py ──▶ orchestrator.py (approved actions only)        │
│  WhatsApp notifier → Pending_Approval/ → phone notification      │
│  WhatsApp webhook (Flask :5001) → APPROVE/REJECT replies         │
│  Executes: email_send, linkedin_post, fb_post, tweet, payments   │
└──────────────────────────┬───────────────────────────────────────┘
                           │ HTTPS / XML-RPC / REST / WhatsApp
              ┌────────────┼──────────────────┐
              ▼            ▼                  ▼
       ┌────────────┐ ┌──────────┐  ┌─────────────────┐
       │ Azure ACI  │ │ Neon DB  │  │   Cloud APIs     │
       │ Odoo+Caddy │─▶│(Postgres)│  │ • Gmail API      │
       │  (HTTPS)   │ └──────────┘  │ • LinkedIn API   │
       └────────────┘               │ • Meta Graph API │
                                    │ • Twitter API v2 │
                                    │ • WhatsApp Biz   │
                                    └─────────────────┘
```

### How It Works (Data Flow)

1. **Input**: Files dropped in `Inbox/` or emails arrive via Gmail API polling
2. **Triage**: Watchers create metadata `.md` files in `Needs_Action/` with YAML frontmatter (type, priority, status)
3. **Processing**: Orchestrator reads pending tasks, invokes **Claude Code CLI** as subprocess for reasoning
4. **Planning**: Complex tasks (5+ checklist items, multi-step flag) get a `Plans/PLAN_*.md` generated by Claude
5. **Approval**: Sensitive actions (emails, social posts, payments >$100) → `Pending_Approval/`
6. **Human Review**: User reviews in Obsidian, physically moves file to `Approved/` or `Rejected/`
7. **Execution**: Orchestrator detects approved files, delegates to skill modules + MCP servers
8. **Archival**: Completed tasks → `Done/` with timestamp prefix, all actions → `Logs/YYYY-MM-DD.json`
9. **Reporting**: Scheduler triggers daily briefings, weekly audits, CEO briefings automatically

---

## Tier Breakdown

### Bronze Tier: Foundation

> **Requirement**: Obsidian vault, one watcher, Claude Code reading/writing vault, basic folder structure, agent skills

#### What We Built

**1. Obsidian Vault (`AI_Employee_Vault/`)**

The vault is the AI Employee's "brain" — a file-based state machine where every folder represents a workflow state. Files physically move between folders as they progress through the pipeline.

- `Dashboard.md` — Live status dashboard auto-updated by the orchestrator. Shows counts per folder, system status (watchers, orchestrator, Odoo), approval queue, and quick links. Version-tracked with YAML frontmatter.
- `Company_Handbook.md` — The rules the AI Employee must follow. Priority levels (critical/high/medium/low), financial rules ($100 payment threshold), communication rules, file processing rules. Claude reads this before every task.
- 10 vault folders: `Inbox/`, `Needs_Action/`, `In_Progress/`, `Done/`, `Pending_Approval/`, `Approved/`, `Rejected/`, `Logs/`, `Briefings/`, `Plans/`

**2. Filesystem Watcher (`watchers/filesystem_watcher.py`)**

Built with `watchdog` library. Monitors `Inbox/` using OS-level filesystem events (`on_created`, `on_moved`). When a file appears:
- Classifies priority by file extension (`.pdf`/`.xlsx` = high, `.txt`/`.md` = medium, else low)
- Copies the original file to `Needs_Action/`
- Creates a metadata `.md` file with YAML frontmatter: `type: file_drop`, `original_name`, `file_extension`, `size_bytes`, `created` timestamp, `priority`, `status: pending`
- Includes suggested action checklist in the markdown body
- Skips hidden files, `.tmp` files, and duplicates via processed-set tracking

**3. Claude Code Integration (`orchestrator.py` → `invoke_claude()`)**

The orchestrator invokes Claude Code CLI as a subprocess:
```python
subprocess.run(["claude.cmd", "-p", prompt, "--output-format", "text"],
               capture_output=True, text=True, timeout=120, cwd=str(vault))
```
- Passes the task content + Company Handbook as prompt context
- Claude reads vault files, reasons about the task, and writes results back
- Handles Windows (`claude.cmd`) and Unix (`claude`) automatically
- Timeout: 120 seconds, with retry logic (up to 2 retries on timeout)
- Fallback: if Claude CLI not found, returns clear error message

**4. Agent Skills (defined in `CLAUDE.md`)**

All AI functionality is implemented as agent skills — slash commands that Claude executes:
- `/process-inbox` — Scan `Needs_Action/`, process by priority, log actions, update dashboard
- `/update-dashboard` — Refresh `Dashboard.md` with current folder counts and system status
- `/create-plan` — Generate structured `Plans/PLAN_*.md` for complex tasks (objective, checklist, approvals, dependencies)
- `/triage-file` — Classify a new file by content, assign priority, create action file

---

### Silver Tier: Functional Assistant

> **Requirement**: Two+ watchers, LinkedIn posting, Claude reasoning loop with Plans, MCP server for email, human-in-the-loop approval, scheduling

#### What We Built (on top of Bronze)

**1. Gmail Watcher (`watchers/gmail_watcher.py`)**

Second watcher that polls Gmail API for unread emails:
- **Authentication**: OAuth 2.0 flow with `credentials.json` → `token.json`. Auto-refreshes expired tokens.
- **Polling**: `fetch_unread_emails()` calls Gmail API `users().messages().list(q="is:unread")`, then fetches full message body (plain text, base64-decoded)
- **Priority Classification**: `classify_email_priority()` checks labels (IMPORTANT → high) and subject keywords ("urgent"/"payment" → critical, "meeting"/"deadline" → high, "update"/"fyi" → medium)
- **Deduplication**: Tracks processed message IDs in `.gmail_processed_ids.json` (keeps last 1000 IDs)
- **Action File**: Creates `EMAIL_<message_id>_<time>.md` in `Needs_Action/` with sender, subject, date, body, and suggested actions

So we have 2 watchers: **Filesystem** (real-time via watchdog) + **Gmail** (polling every 2 minutes via scheduler).

**2. LinkedIn Auto-Poster (`skills/linkedin_poster.py`)**

Generates LinkedIn posts to generate sales for the business:
- `create_post_draft(vault)` → Creates `Pending_Approval/LINKEDIN_POST_<date>.md` with frontmatter `action: linkedin_post`
- Reads `Business_Goals.md` for content themes and tone guidelines
- Scheduler fills draft content using Claude: professional, under 1300 chars, max 3 hashtags, ends with CTA
- `execute_approved_post(approved_file)` → Extracts post text from `## Post Content` section, calls LinkedIn REST API (`/rest/posts`) with OAuth Bearer token
- DRY_RUN mode: logs the intended post without hitting LinkedIn API
- One draft per day max (prevents duplicates)

**3. Claude Reasoning Loop with Plans (`orchestrator.py` → `create_plan()`)**

When a task is complex (detected by `needs_planning()` heuristic):
- **Detection**: frontmatter `type: complex/multi_step/project`, or `needs_plan: true`, or 5+ checklist items, or "multi-step" in body text
- **Plan Generation**: Sends task + Company Handbook to Claude with structured prompt. Claude generates a `Plans/PLAN_<task_name>.md` with: Objective, Steps (checklist), Required Approvals, Estimated Actions, Priority, Dependencies
- **Fallback**: If Claude fails, a template plan is auto-generated
- Plans stay as active reference documents the AI Employee follows

**4. Email MCP Server (`mcp_servers/email_server.py`)**

Our first MCP (Model Context Protocol) server — gives Claude tools to interact with Gmail:
- **Protocol**: JSON-RPC 2.0 over stdin/stdout (same protocol Claude Code uses natively)
- **3 Tools**:
  - `send_email` — Send via Gmail API (requires `to`, `subject`, `body`)
  - `draft_email` — Create a Gmail draft
  - `list_drafts` — List recent drafts
- **Registration**: `.claude/mcp.json` registers the server so Claude Code auto-starts it
- **DRY_RUN**: All tools respect the safety flag — logs intended action without sending
- **Authentication**: Same Google OAuth flow as Gmail watcher, with `gmail.send` + `gmail.compose` scopes

**5. Human-in-the-Loop Approval Workflow**

The core safety mechanism. Sensitive actions never auto-execute:
- Orchestrator creates action files in `Pending_Approval/` with `action: <type>` in frontmatter
- **Actions requiring approval**: sending emails (`action: email_send`), LinkedIn posts (`action: linkedin_post`), any payment
- Human reviews the file in Obsidian — it's a readable markdown document with all details
- Move to `Approved/` → orchestrator calls the appropriate skill module to execute
- Move to `Rejected/` → orchestrator archives to `Done/` with `action_rejected` log entry
- `process_approved_actions()` reads frontmatter `action` field to dispatch: `linkedin_post` → `skills.linkedin_poster.execute_approved_post()`, `email_send` → Claude + email MCP

**6. Scheduling (`scheduler.py`)**

Uses the `schedule` library to run all jobs:
- Gmail polling: every 2 minutes
- Task processing (`run_once()`): every 30 seconds
- Daily briefing: 8:00 AM (generates `Briefings/YYYY-MM-DD_Daily.md` with completed/pending/awaiting-approval summaries)
- LinkedIn draft: Monday 10:00 AM
- Filesystem watcher runs in a background thread via `threading.Thread(daemon=True)`
- Initial task processing runs on startup

**7. Additional Silver Skills**:
- `/daily-briefing` — Aggregate today's Done/Pending/Logs data, Claude generates a professional daily report
- `/process-emails` — Triage email action files, classify, draft replies (with approval)
- `/approve-action` — Explains the HITL workflow to the user
- `/weekly-summary` — Aggregate 7 days of daily briefings

---

### Gold Tier: Autonomous Employee

> **Requirement**: Odoo accounting, Facebook + Instagram + Twitter, multiple MCP servers, weekly audit with CEO briefing, error recovery, audit logging, Ralph Wiggum loop, documentation

#### What We Built (on top of Silver)

**1. Odoo Accounting on Azure Cloud (`mcp_servers/odoo_server.py`)**

Full accounting system integrated via Odoo Community Edition:
- **Infrastructure**: Odoo 17 runs as a Docker container on **Azure Container Instances** (ACI). Database is **Neon DB** (serverless PostgreSQL). No local Docker needed.
- **Connection**: `OdooClient` class connects via Python's `xmlrpc.client.ServerProxy` to `ODOO_URL/xmlrpc/2/object`
- **Authentication**: `common.authenticate(db, username, password)` returns user ID for all subsequent calls
- **7 MCP Tools**:
  - `create_invoice` — Creates customer invoice. Finds-or-creates partner, creates `account.move` with line items
  - `list_invoices` — Lists recent customer/vendor invoices with partner, amount, state, date
  - `get_invoice` — Get detailed invoice by ID (including residual amount, due date, line items)
  - `create_payment` — Register outbound payment. **Payments >$100 are blocked** and return `needs_approval: true` per Company Handbook
  - `get_balance` — Full chart of accounts with current balances (47 accounts)
  - `list_journal_entries` — Recent journal entries
  - `get_profit_loss` — Simplified P&L: sums income vs expense account balances
- **DRY_RUN**: Invoice creation and payments are no-ops in dry run mode
- **Health**: Scheduler pings Odoo every 5 minutes, `ServiceHealthChecker` tracks up/down status
- **Live Data**: Currently has 7+ invoices (Azure Interior, Acme Corporation, Ali), Bank balance $12,444.87, Product Sales $2,500

**2. Facebook & Instagram Integration (`skills/meta_poster.py`)**

Posts to Facebook Page and Instagram via Meta Graph API v19.0:
- `post_to_facebook(text, config)` — Posts to `/{page_id}/feed` with page access token
- `post_to_instagram(text, image_url, config)` — Two-step process: (1) create media container at `/{ig_account_id}/media` with `image_url` + `caption`, (2) publish with `/{ig_account_id}/media_publish` and `creation_id`
- `create_post_draft(vault, platform)` — Creates `FB_POST_<date>.md` or `IG_POST_<date>.md` in `Pending_Approval/` with `action: facebook_post` or `action: instagram_post`
- `execute_approved_post(approved_file)` — Reads frontmatter to detect platform, extracts post text from `## Post Content` section
- `generate_meta_summary(vault, days)` — Aggregates posting stats from log files
- Instagram requires `image_url` in frontmatter (validated before publish)
- **Live tested**: Facebook post `1009023102288739_122095456215267502` and Instagram post `17864089473583184` published successfully
- Token management: `scripts/meta_auth.py` exchanges short-lived user tokens for long-lived page tokens via Graph API

**3. Twitter/X Integration (`skills/twitter_poster.py`)**

Posts tweets via Twitter API v2 using `tweepy`:
- `get_twitter_client()` — Returns authenticated `tweepy.Client` with API key, secret, access token
- `post_tweet(text)` — Enforces 280-character limit, calls `client.create_tweet(text=text)`
- Same draft/approve/execute pattern as other platforms
- Drafts saved as `TWEET_<date>.md` with `action: twitter_post`

**4. Social Media MCP Server (`mcp_servers/social_server.py`)**

Third MCP server — gives Claude tools for all social platforms:
- **6 Tools**: `post_facebook`, `post_instagram`, `post_tweet`, `draft_social_post`, `get_social_summary`, `list_pending_posts`
- Delegates to `skills/meta_poster.py` and `skills/twitter_poster.py`
- All tools respect DRY_RUN mode

**5. Weekly Audit & CEO Briefing (`skills/weekly_audit.py`)**

Automated weekly reporting system:
- `aggregate_weekly_data(vault, days=7)` — Reads `Done/` files (by date prefix), `Logs/*.json` entries, `Pending_Approval/` and `Rejected/` folders. Counts by action type, social media platform, emails processed.
- `generate_weekly_briefing()` → `Briefings/YYYY-WXX_Weekly.md` — Detailed: overview stats, completed tasks list, action breakdown table, pending approvals, rejected items, recommendations
- `generate_ceo_briefing()` → `Briefings/YYYY-WXX_CEO_Briefing.md` — Executive-level: KPI dashboard table (tasks, emails, social posts, pending, rejected, total actions), social media breakdown table, key achievements, action items, strategic recommendations
- Scheduled: Sunday 8:00 PM automatically

**6. Error Recovery & Graceful Degradation (`utils/retry.py`)**

- `@retry_with_backoff(max_retries, base_delay, max_delay)` — Decorator with exponential backoff. Used on Odoo authentication, API calls. Delays: 1s → 2s → 4s → ... up to max_delay cap.
- `@graceful_degrade(fallback_value)` — Catches exceptions, logs error, returns fallback instead of crashing
- `ServiceHealthChecker` — Singleton (`health`) tracks per-service status: `record_success(service)`, `record_failure(service, error)`, `is_healthy(service)`, `summary()`. Used by Odoo health check, social media posting.
- `invoke_claude()` retries up to 2 times on timeout
- Orchestrator catches import errors for missing skill modules (graceful skip)
- Scheduler wraps every job in try/except (one job failure doesn't crash others)

**7. Comprehensive Audit Logging (`utils/audit.py` + `orchestrator.log_action()`)**

- Every action appends to `Logs/YYYY-MM-DD.json` — JSON array of timestamped entries
- Fields: `timestamp` (UTC ISO), `action_type`, `actor`, `result`, `task_file`, `summary`, plus custom fields
- `utils/audit.py` — Thin wrapper enforcing consistent field naming across all modules
- Action types logged: `task_processed`, `plan_created`, `approved_action_executed`, `action_rejected`, `daily_briefing_generated`, `linkedin_draft_generated`, `facebook_draft_generated`, `twitter_draft_generated`, `instagram_draft_generated`, `weekly_audit_completed`

**8. Ralph Wiggum Loop (`skills/task_state.py` + `.claude/hooks/stop.py`)**

Named after the Simpsons meme "I'm in danger" — keeps Claude working until multi-step tasks finish:
- `start_multi_step_task(vault, name, steps)` — Creates `.task_state.json` with step list, iteration counter
- `complete_step(vault, step_id)` — Marks individual step as done
- `.claude/hooks/stop.py` — Claude Code stop hook. When Claude tries to exit:
  - Reads `.task_state.json`
  - If incomplete steps exist → outputs `{"decision": "block", "reason": "..."}` → Claude continues working
  - If all steps done → outputs `{"decision": "allow"}` → Claude exits normally
- **Safety**: Hard limit of `MAX_ITERATIONS = 10` prevents infinite loops
- Orchestrator auto-initializes Ralph Wiggum state from plan checklist items when complex tasks are detected
- Registered in `.claude/settings.local.json` as a stop hook

**9. Documentation**

- `docs/ARCHITECTURE.md` — System diagram, component descriptions, data flow, cloud vs local table
- `docs/LESSONS_LEARNED.md` — Architecture decisions, trade-offs, challenges
- `docs/ODOO_SETUP.md` — Neon DB + Azure ACI deployment guide (step-by-step)
- `docs/META_SETUP.md` — Meta Developer App + Graph API setup
- `docs/TWITTER_SETUP.md` — Twitter Developer Portal + API v2 keys
- `docs/GMAIL_SETUP.md` — Google Cloud Console + OAuth credentials
- `docs/LINKEDIN_SETUP.md` — LinkedIn Developer App setup
- `CLAUDE.md` — All 15 agent skill definitions

**10. Extended Orchestrator & Scheduler**

Orchestrator additions:
- `get_pending_tasks()` now handles prefixes: `FILE_`, `EMAIL_`, `TASK_`, `LINKEDIN_`, `FB_`, `IG_`, `TWEET_`, `ODOO_`
- `process_approved_actions()` dispatches: `facebook_post` → meta_poster, `instagram_post` → meta_poster, `twitter_post` → twitter_poster, `odoo_invoice` → Claude + Odoo MCP, `odoo_payment` → Claude + Odoo MCP
- Dashboard shows social media pending count, Odoo connection status

Scheduler additions:
- Tuesday 10:30 AM: Facebook draft
- Wednesday 10:30 AM: Twitter/X draft
- Thursday 10:30 AM: Instagram draft
- Sunday 8:00 PM: Weekly audit + CEO briefing
- Every 5 minutes: Odoo health check (pings Azure URL)
- `_fill_social_draft()` helper: reads `Business_Goals.md`, asks Claude to generate platform-specific content

---

### Platinum Tier: Cloud/Local Split Deployment

> **Requirement**: Cloud 24/7 deployment, work-zone specialization (Cloud vs Local), vault sync via Git, mobile approval workflow

#### What We Built (on top of Gold)

**1. Zone System (`ZONE=cloud|local`)**

Split the AI Employee into two cooperating zones:

| Zone | Responsibilities |
|------|-----------------|
| **Cloud** (Azure VM) | Email triage, social media drafts, briefings, weekly audit, dashboard updates, Odoo reads |
| **Local** (your laptop) | Approved action execution (email send, social post, payments), WhatsApp notifications |

- `orchestrator.py`: `get_pending_tasks()` filters by task prefix per zone. Cloud handles `EMAIL_*`, `FILE_*`, `TASK_*`, `LINKEDIN_*`, `FB_*`, `IG_*`, `TWEET_*`, `ODOO_*`. Local handles `WHATSAPP_*` and unmatched.
- `process_approved_actions()`: Only LOCAL zone executes approved actions — cloud skips with log line
- `scheduler.py`: Zone-gates jobs — Gmail poll/briefings/audit = cloud only, WhatsApp notify = local only
- `main.py`: `--zone cloud|local` CLI argument overrides `ZONE` env var
- Dashboard single-writer rule: Only `DASHBOARD_ZONE` (cloud by default) updates `Dashboard.md`

**2. Vault Git Sync (`utils/vault_sync.py`)**

Turns `AI_Employee_Vault/` into a Git-synced repository between zones:
- `sync_vault(vault)`: Pull (rebase), stage `*.md` only, commit with `[{ZONE}] auto-sync {timestamp}`, push
- `pull_only(vault)`: Pull without pushing (read-only sync)
- Scheduled every 60 seconds via `job_vault_sync()` (configurable via `VAULT_SYNC_INTERVAL`)
- Also triggers after `process_approved_actions()` and at end of `run_once()`
- `AI_Employee_Vault/.gitignore` excludes `.obsidian/`, `Logs/`, `Inbox/`, credentials
- Commit messages include zone attribution: `[cloud] auto-sync 2026-02-12T10:00:00Z`

**3. Azure VM Deployment (24/7 Cloud Zone)**

- `scripts/vm_bootstrap.sh`: One-command setup (git, Python 3.11, Node.js 20, Claude Code CLI, uv)
- `scripts/ai-employee-cloud.service`: systemd unit with `Restart=always`, `RestartSec=10`
- `docs/AZURE_VM_SETUP.md`: Step-by-step guide (VM creation, SSH, bootstrap, systemd, verification)
- Cost: ~$35/month (Standard_B2s VM + disk + public IP)

**4. HTTP Health Endpoint (`utils/health_server.py`)**

- Daemon thread serving `GET /health` on port 8080
- Returns JSON: `{"status": "ok", "zone": "cloud", "timestamp": "...", "vault_ok": true, "services": {...}}`
- Auto-started by `run_scheduler()` on boot
- Uses `ServiceHealthChecker` singleton for per-service health status
- `last_check_age_seconds(service)` method added to `utils/retry.py`

**5. WhatsApp Business API (`skills/whatsapp_notifier.py`)**

Mobile-first approval workflow:
- `send_approval_request(file_path, vault)`: POST to Meta Graph API WhatsApp endpoint
- Message format: "AI Employee needs approval: File: X, Action: Y, Reply APPROVE/REJECT filename"
- `process_whatsapp_reply(reply_text, vault)`: Parses "APPROVE filename" / "REJECT filename", moves file
- `utils/whatsapp_webhook.py`: Flask app with GET/POST `/webhook` routes
  - GET: Meta verification challenge
  - POST: Inbound message handler → calls `process_whatsapp_reply()`
- Scheduler: `job_notify_pending_approvals()` every 5 min (local zone) — stamps files with `<!-- whatsapp_notified: true -->`
- Respects `DRY_RUN` mode
- `docs/WHATSAPP_SETUP.md`: Meta Developer Console setup, ngrok for hackathon, test flow

**6. Odoo Hardening**

- `scripts/aci-caddy.yaml`: Multi-container ACI spec — Odoo + Caddy reverse proxy for auto-TLS (Let's Encrypt)
- `scripts/odoo_backup.sh`: Nightly `pg_dump` from Neon DB, 7-day retention
- Enhanced `job_odoo_health_check()`: On failure, writes `odoo_degraded.flag` to `Logs/` and audits
- Dashboard shows Odoo health status from `ServiceHealthChecker` (OK/DEGRADED + last check time)

**7. Demo Gate (`scripts/demo_gate.sh`)**

Automated end-to-end verification:
1. Checks vault structure (10 folders, 3 config files)
2. Drops test `EMAIL_*.md` in `Needs_Action/`
3. Waits for orchestrator processing (max 90s)
4. Verifies file in `Done/` and log entry
5. Checks health endpoint
6. Checks vault git status
7. Reports PASS/FAIL summary

**8. Platinum Documentation**
- `docs/AZURE_VM_SETUP.md` — VM deployment guide
- `docs/WHATSAPP_SETUP.md` — WhatsApp API configuration
- `docs/DEMO.md` — Hackathon demo script with talking points
- Updated `Company_Handbook.md` — Zone ownership rules, WhatsApp approval rules
- Updated `CLAUDE.md` — `/whatsapp-notify` skill definition

---

## Quick Start

### Prerequisites

- **Python 3.11+**
- **[uv](https://docs.astral.sh/uv/)** — Python package manager
- **[Claude Code CLI](https://docs.anthropic.com/en/docs/claude-code)** — Must be installed and authenticated
- **Azure account** — For Odoo hosting (free tier works)
- **API credentials** — See [Setup Guides](#setup-guides)

### Installation

```bash
# 1. Clone the repository
git clone https://github.com/aimanhanif321/hacthon-0.git
cd hacthon-0

# 2. Install dependencies
uv sync

# 3. Copy and configure environment variables
cp .env.example .env
# Edit .env with your actual credentials (see Setup Guides)

# 4. Test with DRY_RUN mode first (DRY_RUN=true in .env)
uv run python main.py --once

# 5. Run full scheduler (production)
uv run python main.py --scheduler
```

### Run Modes

```bash
uv run python main.py                          # File watcher only
uv run python main.py --orchestrator           # Orchestrator only (processes tasks)
uv run python main.py --scheduler              # Full scheduler (all watchers + orchestrator + jobs)
uv run python main.py --scheduler --zone cloud # Cloud zone (Azure VM - triage, drafts, briefings)
uv run python main.py --scheduler --zone local # Local zone (approvals, execution, WhatsApp)
uv run python main.py --once                   # Process pending tasks once and exit
```

---

## All Commands Reference

### Local Machine Commands

```bash
# === Run the AI Employee ===
uv run python main.py                          # File watcher only (Bronze)
uv run python main.py --orchestrator           # Orchestrator only (Silver)
uv run python main.py --once                   # Process once and exit (Silver)
uv run python main.py --scheduler              # Full scheduler - all jobs (Silver+)
uv run python main.py --scheduler --zone local # Local zone only (Platinum)

# === Email (Gmail) ===
# Automatic: Gmail watcher polls every 2 minutes when scheduler is running
# Manual check:
ls AI_Employee_Vault/Needs_Action/EMAIL_*      # See pending emails
ls AI_Employee_Vault/Done/*EMAIL*              # See processed emails

# === LinkedIn ===
# Automatic: Draft generated Monday 10:00 AM
# Manual approve:
mv AI_Employee_Vault/Pending_Approval/LINKEDIN_POST_*.md AI_Employee_Vault/Approved/

# === Facebook ===
# Automatic: Draft generated Tuesday 10:30 AM
# Manual approve:
mv AI_Employee_Vault/Pending_Approval/FB_POST_*.md AI_Employee_Vault/Approved/

# === Twitter/X ===
# Automatic: Draft generated Wednesday 10:30 AM
# Manual approve:
mv AI_Employee_Vault/Pending_Approval/TWEET_*.md AI_Employee_Vault/Approved/

# === Instagram ===
# Automatic: Draft generated Thursday 10:30 AM (add image_url to frontmatter first)
# Manual approve:
mv AI_Employee_Vault/Pending_Approval/IG_POST_*.md AI_Employee_Vault/Approved/

# === File Drop (any file) ===
cp yourfile.pdf AI_Employee_Vault/Inbox/       # Drop file → auto-triaged

# === Vault Status ===
cat AI_Employee_Vault/Dashboard.md             # Live dashboard
ls AI_Employee_Vault/Needs_Action/             # Pending tasks
ls AI_Employee_Vault/Pending_Approval/         # Awaiting human review
ls AI_Employee_Vault/Done/                     # Completed tasks
ls AI_Employee_Vault/Briefings/                # Reports
cat AI_Employee_Vault/Logs/$(date +%Y-%m-%d).json  # Today's audit log
```

### Azure VM Commands (Cloud Zone)

```bash
# === VM Power Management ===
az vm start --resource-group ai-employee-rg --name ai-employee-vm      # START (billing starts)
az vm deallocate --resource-group ai-employee-rg --name ai-employee-vm # STOP (no charges)
az vm show -g ai-employee-rg -n ai-employee-vm -d --query powerState -o tsv  # Check status

# === SSH Access ===
ssh -i ~/.ssh/id_rsa aiemployee@20.64.238.101

# === Service Management (run after SSH) ===
sudo systemctl start ai-employee-cloud          # Start AI Employee
sudo systemctl stop ai-employee-cloud           # Stop AI Employee
sudo systemctl restart ai-employee-cloud        # Restart
sudo systemctl status ai-employee-cloud         # Check status
sudo journalctl -u ai-employee-cloud -f         # Live logs

# === WhatsApp Webhook (run after SSH) ===
sudo systemctl status ai-employee-webhook       # Webhook status
sudo journalctl -u ai-employee-webhook -f       # Webhook logs

# === Health Check (from anywhere) ===
curl -s http://20.64.238.101:8080/health | python -m json.tool
```

### Odoo Accounting Commands

```bash
# === Container Management ===
az container start --resource-group ai-employee-rg --name odoo-server  # Start Odoo
az container stop --resource-group ai-employee-rg --name odoo-server   # Stop (save credits)
az container show -g ai-employee-rg -n odoo-server --query instanceView.state -o tsv  # Status

# === Access Odoo Web UI ===
# URL: http://ai-employee-odoo.eastus.azurecontainer.io:8069
# Login: admin / admin

# === Create Invoice via File Drop ===
cat > AI_Employee_Vault/Needs_Action/ODOO_invoice.md << 'EOF'
---
type: odoo_task
priority: high
status: pending
action: create_invoice
---
# Create Invoice
Customer: Client Name
Items:
- 5x Product at $50 each
EOF
```

### WhatsApp Commands

```bash
# === Send Test Notification (from VM) ===
ssh -i ~/.ssh/id_rsa aiemployee@20.64.238.101 "cd ~/ai_employee && source ~/.local/bin/env && uv run python -c \"
from pathlib import Path
from skills.whatsapp_notifier import send_approval_request
vault = Path('AI_Employee_Vault')
f = list((vault / 'Pending_Approval').glob('*.md'))[0]
print(send_approval_request(f, vault))
\""

# === WhatsApp Reply Commands (on your phone) ===
# APPROVE <filename>    → Moves file to Approved/, orchestrator executes
# REJECT <filename>     → Moves file to Rejected/, archived

# === Restart ngrok (if tunnel expired, from VM) ===
ssh -i ~/.ssh/id_rsa aiemployee@20.64.238.101 "pkill ngrok; nohup ngrok http 5001 --log=/tmp/ngrok.log > /dev/null 2>&1 &"
```

---

## Project Structure

```
ai_employee/
├── main.py                    # Entry point (--once, --scheduler, --orchestrator, --zone)
├── orchestrator.py            # Core coordinator: zone-aware tasks → Claude CLI → skills → vault
├── scheduler.py               # Zone-aware job scheduler (cloud/local gated jobs)
├── pyproject.toml             # Dependencies (httpx, watchdog, tweepy, schedule, flask, google-api)
│
├── watchers/
│   ├── filesystem_watcher.py  # Watchdog-based Inbox/ monitor (Bronze)
│   └── gmail_watcher.py       # Gmail API poller with deduplication (Silver)
│
├── skills/
│   ├── linkedin_poster.py     # LinkedIn REST API posting (Silver)
│   ├── meta_poster.py         # Facebook + Instagram via Meta Graph API (Gold)
│   ├── twitter_poster.py      # Twitter/X via tweepy API v2 (Gold)
│   ├── weekly_audit.py        # Weekly audit + CEO briefing generation (Gold)
│   ├── task_state.py          # Ralph Wiggum multi-step task tracking (Gold)
│   └── whatsapp_notifier.py   # WhatsApp approval requests + reply processing (Platinum)
│
├── mcp_servers/
│   ├── email_server.py        # Gmail send/draft/list MCP tools (Silver)
│   ├── odoo_server.py         # Odoo accounting 7-tool MCP server (Gold)
│   └── social_server.py       # Social media 6-tool MCP server (Gold)
│
├── utils/
│   ├── __init__.py
│   ├── retry.py               # Exponential backoff + health checker (Gold+Platinum)
│   ├── frontmatter.py         # YAML frontmatter parser/creator (Gold)
│   ├── audit.py               # Audit logging wrapper (Gold)
│   ├── vault_sync.py          # Git-based vault sync between zones (Platinum)
│   ├── health_server.py       # HTTP health endpoint daemon (Platinum)
│   └── whatsapp_webhook.py    # Flask webhook for inbound WhatsApp (Platinum)
│
├── scripts/
│   ├── meta_auth.py           # Meta token exchange helper (Gold)
│   ├── vm_bootstrap.sh        # Azure VM one-time setup (Platinum)
│   ├── ai-employee-cloud.service  # systemd unit for cloud zone (Platinum)
│   ├── aci-caddy.yaml         # Odoo + Caddy HTTPS ACI spec (Platinum)
│   ├── odoo_backup.sh         # Neon DB nightly backup (Platinum)
│   └── demo_gate.sh           # End-to-end Platinum demo verification (Platinum)
│
├── .claude/
│   ├── mcp.json               # MCP server registrations (3 servers)
│   ├── hooks/stop.py          # Ralph Wiggum stop hook (Gold)
│   └── settings.local.json    # Claude Code permissions + hooks config
│
├── AI_Employee_Vault/         # Obsidian vault (file-based state machine, Git synced)
│   ├── .gitignore             # Vault-level gitignore (Platinum)
│   ├── Inbox/                 # Drop files here → auto-triaged
│   ├── Needs_Action/          # Pending tasks with YAML frontmatter
│   ├── In_Progress/           # Currently claimed by orchestrator
│   ├── Pending_Approval/      # Awaiting human review (WhatsApp notified)
│   ├── Approved/              # Human-approved → auto-executed (local zone)
│   ├── Rejected/              # Denied → archived
│   ├── Done/                  # Completed (timestamped)
│   ├── Logs/                  # JSON audit logs (per-day)
│   ├── Briefings/             # Daily/weekly reports + CEO briefings
│   ├── Plans/                 # Claude-generated task plans
│   ├── Dashboard.md           # Live status (auto-updated by dashboard zone)
│   ├── Company_Handbook.md    # Business rules + zone ownership rules
│   └── Business_Goals.md      # Content themes per platform
│
├── docs/                      # Setup guides
│   ├── ARCHITECTURE.md        # System diagram + data flow
│   ├── AZURE_VM_SETUP.md      # Cloud zone VM deployment (Platinum)
│   ├── WHATSAPP_SETUP.md      # WhatsApp Business API setup (Platinum)
│   ├── DEMO.md                # Hackathon demo script (Platinum)
│   ├── ODOO_SETUP.md          # Neon DB + Azure ACI deployment
│   ├── META_SETUP.md, TWITTER_SETUP.md, GMAIL_SETUP.md, LINKEDIN_SETUP.md
│   └── LESSONS_LEARNED.md     # Architecture decisions
│
├── CLAUDE.md                  # 16 agent skill definitions (incl. /whatsapp-notify)
├── .env.example               # Environment template (zone + vault sync + WhatsApp vars)
└── .gitignore                 # Protects .env, credentials, tokens
```

---

## Setup Guides

| Service | Guide | What You Need |
|---------|-------|---------------|
| Gmail | [`docs/GMAIL_SETUP.md`](docs/GMAIL_SETUP.md) | Google Cloud Console project, OAuth client ID |
| LinkedIn | [`docs/LINKEDIN_SETUP.md`](docs/LINKEDIN_SETUP.md) | LinkedIn Developer App, OAuth 2.0 token |
| Facebook/Instagram | [`docs/META_SETUP.md`](docs/META_SETUP.md) | Meta Developer App, Page Access Token |
| Twitter/X | [`docs/TWITTER_SETUP.md`](docs/TWITTER_SETUP.md) | Twitter Developer Portal, API v2 keys |
| Odoo + Azure | [`docs/ODOO_SETUP.md`](docs/ODOO_SETUP.md) | Azure account + Neon DB (both have free tiers) |
| Azure VM (Cloud Zone) | [`docs/AZURE_VM_SETUP.md`](docs/AZURE_VM_SETUP.md) | Azure account, SSH key pair |
| WhatsApp Business | [`docs/WHATSAPP_SETUP.md`](docs/WHATSAPP_SETUP.md) | Meta Developer App with WhatsApp product |
| Demo Script | [`docs/DEMO.md`](docs/DEMO.md) | All of the above running |

---

## Security Disclosure

### Credential Handling

| Credential | Storage | Protection |
|------------|---------|------------|
| Gmail OAuth (`credentials.json`, `token.json`) | Local filesystem only | `.gitignore` — never committed |
| LinkedIn/Meta/Twitter API tokens | `.env` file only | `.gitignore` — never committed |
| Odoo admin password | `.env` file only | `.gitignore` — never committed |
| Neon DB connection string | `.env` file only | `.gitignore` — never committed |
| Azure credentials | Azure CLI session | Managed by `az login`, not stored in project |
| `client_secret.json` | Local filesystem only | `.gitignore` — never committed |

**`.env.example`** contains only placeholder values (`your_api_key`, `your_access_token`, etc.) — zero real credentials.

### Safety Controls

1. **DRY_RUN Mode** (`DRY_RUN=true` in `.env`) — Default in `.env.example`. All external actions (email send, social media post, Odoo payment) are logged but NOT executed. Must explicitly set `DRY_RUN=false` for production.

2. **Human-in-the-Loop (HITL) Approval** — Sensitive actions NEVER auto-execute:
   - Sending emails → `Pending_Approval/` → human moves to `Approved/`
   - Publishing social media posts (all 4 platforms) → same workflow
   - Payments exceeding $100 → Odoo MCP returns `needs_approval: true`, orchestrator creates approval file
   - Payments to new payees → always flagged

3. **Audit Logging** — Every action logged to `Logs/YYYY-MM-DD.json` with UTC timestamp, actor, action type, result, and context. Nothing happens silently.

4. **Company Handbook** — Configurable business rules in `Company_Handbook.md`. The AI reads this before every task. Rules include payment thresholds, communication standards, social media limits (280 chars for Twitter, max 3 hashtags), posting schedule.

5. **Ralph Wiggum Safety** — Hard limit of 10 iterations on the stop hook prevents infinite Claude loops.

6. **No Secrets in Git** — `.gitignore` covers: `.env`, `credentials.json`, `client_secret.json`, `token.json`, `.task_state.json`

### What the AI Employee CAN vs CANNOT Do

| CAN (with human approval) | CANNOT (by design) |
|---------------------------|-------------------|
| Send emails (after file moved to Approved/) | Send emails autonomously |
| Post to LinkedIn/FB/IG/Twitter (after approval) | Post without human review |
| Create invoices in Odoo | Auto-approve payments >$100 |
| Generate reports and briefings | Delete original files (always moves to Done/) |
| Triage and categorize incoming items | Share confidential data externally |
| Create task plans for complex work | Bypass the approval workflow |

---

## Scheduled Jobs

| Time | Day | Job | Zone | Tier |
|------|-----|-----|------|------|
| Every 30s | Always | Process pending tasks | Both | Silver |
| Every 60s | Always | Vault Git sync | Both | Platinum |
| Every 2 min | Always | Poll Gmail for new emails | Cloud | Silver |
| Every 5 min | Always | Odoo health check | Both | Gold |
| Every 5 min | Always | WhatsApp notify pending | Local | Platinum |
| 08:00 | Daily | Generate daily briefing | Cloud | Silver |
| 10:00 | Monday | LinkedIn post draft | Cloud | Silver |
| 10:30 | Tuesday | Facebook post draft | Cloud | Gold |
| 10:30 | Wednesday | Twitter/X post draft | Cloud | Gold |
| 10:30 | Thursday | Instagram post draft | Cloud | Gold |
| 20:00 | Sunday | Weekly audit + CEO briefing | Cloud | Gold |

---

## Cloud Infrastructure

| Component | Service | Region | Status | Cost |
|-----------|---------|--------|--------|------|
| AI Employee Cloud Zone | Azure VM (Standard_B2s_v2) | westus2 | Running at `20.64.238.101` | ~$35/month (deallocatable) |
| Odoo 17 | Azure Container Instances | eastus | `ai-employee-odoo.eastus.azurecontainer.io:8069` | ~$1.50/day (stoppable) |
| PostgreSQL | Neon DB (serverless) | eastus2 | Active | Free tier (0.5 GB) |
| WhatsApp Webhook | ngrok tunnel → Flask :5001 on VM | — | Active | Free tier |
| Gmail API | Google Cloud | — | Active | Free |
| LinkedIn API | LinkedIn Developer | — | Active | Free |
| Meta Graph API (FB/IG) | Meta Developer | — | Active | Free |
| Twitter API v2 | Twitter Developer | — | Active | Free |
| WhatsApp Business API | Meta Graph API | — | Active | Free (sandbox) |

```bash
# === Save Money: Pause Everything ===

# Stop VM (no charges when deallocated):
az vm deallocate --resource-group ai-employee-rg --name ai-employee-vm

# Stop Odoo container (no charges when stopped):
az container stop --resource-group ai-employee-rg --name odoo-server

# === Before Demo: Start Everything ===

# Start VM (~2 min to boot, service auto-starts):
az vm start --resource-group ai-employee-rg --name ai-employee-vm

# Start Odoo:
az container start --resource-group ai-employee-rg --name odoo-server

# Verify everything is running:
curl -s http://20.64.238.101:8080/health | python -m json.tool
```

---

## Demo Highlights

> Full demo guide with all commands: **[docs/DEMO.md](docs/DEMO.md)**

### Bronze Tier (Foundation)
1. **Obsidian Vault** — 10-folder file-based state machine (`Inbox/` → `Needs_Action/` → `Done/`)
2. **File Drop Triage** — Drop any file in `Inbox/` → watchdog detects it → action `.md` created with auto-classified priority
3. **Claude Code Integration** — Claude CLI subprocess with 120s timeout, retry logic, Company Handbook context
4. **Agent Skills** — 16 slash commands defined in `CLAUDE.md` (e.g., `/process-inbox`, `/triage-file`)

### Silver Tier (Functional Assistant)
5. **Gmail Watcher** — Polls every 2 min via OAuth 2.0, creates `EMAIL_*.md` in `Needs_Action/`
6. **LinkedIn Auto-Poster** — Claude generates drafts from `Business_Goals.md` → human approves → API publishes
7. **Email MCP Server** — `send_email`, `draft_email`, `list_drafts` tools via JSON-RPC 2.0
8. **Human-in-the-Loop** — `Pending_Approval/` → human moves to `Approved/` or `Rejected/` in Obsidian
9. **Scheduling** — Gmail 2min, tasks 30s, briefing 8AM, LinkedIn Monday 10AM

### Gold Tier (Autonomous Employee)
10. **Odoo Accounting on Azure** — Live at `ai-employee-odoo.eastus.azurecontainer.io:8069` — invoices, payments, P&L, 47 accounts
11. **4 Social Platforms** — LinkedIn + Facebook + Instagram + Twitter — all with draft → approve → publish flow
12. **Live Facebook Post** — Published post ID `1009023102288739_122095456215267502` via Meta Graph API
13. **Live Instagram Post** — Published post ID `17864089473583184` via 2-step media container flow
14. **Invoice Creation** — "Create invoice for Ali - 5x Widget at $50" → Odoo invoice ID 25 → Neon DB
15. **Accounting Dashboard** — Bank $12,444.87, Product Sales $2,500, 7+ invoices
16. **CEO Briefing** — Weekly auto-generated KPI dashboard with action items
17. **Ralph Wiggum Loop** — Stop hook blocks Claude exit until all multi-step tasks complete (max 10 iterations)
18. **Error Recovery** — Exponential backoff, graceful degradation, `ServiceHealthChecker` singleton

### Platinum Tier (Cloud/Local Split Deployment)
19. **Cloud Zone (Azure VM)** — Running 24/7 at `20.64.238.101` — triage, drafts, briefings, audit
20. **Local Zone (Laptop)** — Executes approved actions, WhatsApp notifications — zero-trust model
21. **Health Endpoint** — [http://20.64.238.101:8080/health](http://20.64.238.101:8080/health) → live JSON status
22. **WhatsApp Mobile Approvals** — Pending → WhatsApp notification → reply `APPROVE filename` → webhook executes
23. **Vault Git Sync** — `[cloud] auto-sync` / `[local] auto-sync` commits every 60s — Git as message bus
24. **24/7 Operation** — systemd + `Restart=always` — kill the process, back in 10 seconds
25. **Odoo Hardening** — Caddy HTTPS + nightly `pg_dump` backup with 7-day retention
26. **Demo Gate** — `bash scripts/demo_gate.sh` → automated end-to-end verification

---

## Tech Stack

| Component | Technology |
|-----------|-----------|
| Reasoning Engine | Claude Code CLI (Claude Opus) |
| Language | Python 3.11+ |
| Package Manager | uv |
| MCP Protocol | JSON-RPC 2.0 over stdin/stdout |
| Vault | Obsidian (file-based state machine) |
| Vault Sync | Git push/pull (Platinum) |
| Email | Gmail API + Google OAuth 2.0 |
| LinkedIn | LinkedIn REST API v2 |
| Facebook/Instagram | Meta Graph API v19.0 |
| Twitter/X | Twitter API v2 via tweepy |
| WhatsApp | Meta Graph API WhatsApp Business (Platinum) |
| Accounting | Odoo 17 Community via XML-RPC |
| Cloud Zone | Azure VM (Ubuntu 22.04) + systemd (Platinum) |
| Odoo Hosting | Azure Container Instances + Caddy TLS |
| Database | Neon DB (serverless PostgreSQL) |
| Scheduling | schedule library |
| File Watching | watchdog library |
| HTTP Client | httpx |
| Webhook Server | Flask (Platinum) |
| Health Endpoint | http.server (stdlib, Platinum) |

---

## License

MIT
